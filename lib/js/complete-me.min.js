(function(){var a,b,c,d,e=function(a,b){return function(){return a.apply(b,arguments)}},f=[].slice;d=function(){},a=function(){function a(a,b){this.updateData=e(this.updateData,this),this.onMouseDown=e(this.onMouseDown,this),this.onScroll=e(this.onScroll,this),this.onBlur=e(this.onBlur,this),this.onFocus=e(this.onFocus,this),this.onKeyDown=e(this.onKeyDown,this),this.onKeyUp=e(this.onKeyUp,this),this.handleElm(a),this.elm?(this.options=c.extend({},this.defaultOptions,b),this.options.decodeHTMLEntities&&(this.options.data=c.decode(this.options.data)),this.allResults=this.options.data,this.handleTemplate(),this.bindPersistentEvents(),this.allResults.length>0&&(this.resultsAreObjects="object"==typeof this.options.data[0],this.handleInitialResults())):console.warn("CompleteMe couldn't find and initialize "+a)}return a.prototype.defaultOptions={data:[],placeholder:"Type here...",noResultsText:"Couldn't find",canAddNewRecordsText:'Hit <span class="cm-key">enter</span> to add',fetchingMoreResultsText:"Fetching more results...",canAddNewRecords:!1,onAdd:d,onSelect:d,onNoResults:d,onFocussed:d,onBlurred:d,onKeyedDown:d,onKeyedUp:d,onShowSuggestion:d,onClearSuggestion:d,onSuggestionSelected:d,suggestResult:!1,saveByValue:!0,decodeHTMLEntities:!1},a.prototype.domCap=10,a.prototype.resultsOpen=!1,a.prototype.resultsAreObjects=!1,a.prototype.version="0.1.1",a.prototype.handleElm=function(a){return"string"==typeof a?this.elm=document.querySelector(a):"object"==typeof a&&a.nodeName?this.elm=a:void 0},a.prototype.bindPersistentEvents=function(){return this.input.addEventListener("focus",this.onFocus)},a.prototype.bindEvents=function(){return this.input.addEventListener("keyup",this.onKeyUp),this.input.addEventListener("keydown",this.onKeyDown),this.input.addEventListener("blur",this.onBlur),this.resultsWrapperElm.addEventListener("scroll",c.throttle(this.onScroll,25)),this.resultsWrapperElm.addEventListener("mousedown",this.onMouseDown)},a.prototype.unbindEvents=function(){return this.input.removeEventListener("keyup",this.onKeyUp),this.input.removeEventListener("keydown",this.onKeyDown),this.input.removeEventListener("blur",this.onBlur),this.resultsWrapperElm.removeEventListener("scroll",this.onScroll),this.resultsWrapperElm.removeEventListener("mousedown",this.onMouseDown)},a.prototype.onKeyUp=function(a){var d,e,f,g,h;return h=a.target.value,d=b.isAlphanumeric(a.keyCode),e=b.isBackspace(a.keyCode),g=b.isSpace(a.keyCode),f=b.isEnter(a.keyCode),d||e||g?(this.resultsOpen||this.showResults(),this.handleSearch(h),this.options.onKeyedUp(h)):f&&this.selectedResult?(this.handleSelectedResult(),this.resultsOpen=!1):this.options.canAddNewRecords&&c.present(h)&&f?(this.input.focus(),this.hideResults(),this.options.onAdd(h)):void 0},a.prototype.onKeyDown=function(a){var c,d,e;return c=b.isBackspace(a.keyCode),d=b.isEnter(a.keyCode),b.isUpOrDown(a.keyCode)&&(a.preventDefault(),this.domResults.length>0&&this.handleUpOrDown(b.upAndDownKeys[a.keyCode])),b.isRightOrTab(a.keyCode)&&(e=this.options.suggestResult&&this.input.value&&this.suggestionElm.dataset.result.length>0&&this.suggestionElm.dataset.result.length>this.input.value.length,e&&(a.preventDefault(),this.selectSuggestedResult(b.rightAndTabKeys[a.keyCode]))),d&&a.preventDefault(),this.options.onKeyedDown(a)},a.prototype.onFocus=function(){var a;return this.bindEvents(),this.allResults.length>0&&this.options.suggestResult&&(a=this.resultsAreObjects?this.domResults[0].value:this.domResults[0],this.handleSuggestion(a)),this.handleSearch(this.input.value),this.showResults(),c.addClass("focussed",this.elm),this.options.onFocussed()},a.prototype.onBlur=function(){return this.unbindEvents(),this.hideResults(),c.removeClass("focussed",this.elm),this.options.onBlurred()},a.prototype.onScroll=function(a){var b,c;return c=Math.round(this.resultsWrapperElm.scrollTop/this.singleResultHeight),b=c+this.domCap,b<=this.options.data.length?(c!==this.previousScrollIndex&&(this.domResults=this.allResults.slice(c,b),this.handleResults(c),this.handleScroll(c),this.addScrollSpace(),this.manualScroll?this.handleActiveState():this.selectedIndex=c,this.manualScroll=!1,this.selectedResult=null),this.previousScrollIndex=c):void 0},a.prototype.onMouseDown=function(a){var b;return a.target!==this.resultsWrapperElm&&(b=this.allResults.length>0)?(this.selectedResult=a.target.querySelector("a"),this.selectedIndex=parseInt(this.selectedResult.dataset.index),this.handleActiveState(),this.handleSelectedResult(),window.requestAnimationFrame(function(a){return function(){return a.input.focus(),a.hideResults()}}(this))):void 0},a.prototype.handleInitialResults=function(){var a,b;return this.options.selectedValue&&(this.setSaveValue(this.options.selectedValue),this.setValue(this.options.selectedValue)),this.options.selectedKey?c.present(this.options.selectedKey)?(b=c.where("key",this.options.selectedKey,this.options.data)[0].value,this.options.saveByValue?this.setSaveValue(b):this.setSaveValue(this.options.selectedKey),this.setValue(b)):void 0:(a=0,this.selectedIndex=-1,this.domResults=this.allResults.slice(a,a+this.domCap),this.insertSingleResultWrappers(),this.handleResults(a))},a.prototype.setSaveValue=function(a){return this.elm.dataset.saveValue=a},a.prototype.handleUpOrDown=function(a){var b;if(this.previousIndex=this.selectedIndex,"DOWN"===a&&this.selectedIndex+1<this.allResults.length&&this.selectedIndex++,"UP"===a&&this.selectedIndex-1>-1&&this.selectedIndex--,this.selectedIndex!==this.previousIndex){if(b=this.elm.querySelector("a.index-"+this.selectedIndex))return this.handleActiveState();if(this.allResults[this.selectedIndex])return this.updateDomResults(a)}},a.prototype.handleSearch=function(a,b){var c,d,e,f;return null==b&&(b=!1),f=0,this.handleAllResults(a),e=this.allResults.length>0,this.selectedIndex=-1,this.selectedResult=null,e?(c=this.allResults.length>this.domCap?this.domCap:this.allResults.length,this.domResults=this.allResults.slice(f,c),this.insertSingleResultWrappers(),this.handleResults(f),this.resultsWrapperElm.scrollTop=0):(this.domResults=[],this.options.suggestResult&&this.clearSuggestion(),b?this.handleNoResults(a):(d=this.options.onNoResults(a),d?this.handleFetchingResults():this.handleNoResults(a)))},a.prototype.handleAllResults=function(a){return this.resultsAreObjects?this.allResults=c.findOccurrenceInObject(a,this.options.data):this.allResults=c.findOccurrenceInArray(a,this.options.data)},a.prototype.handleSelectedResult=function(){var a,b;return this.input.value=this.selectedResult.dataset.result,a=null!=(b=this.allResults[this.selectedResult.dataset.index])?b.key:void 0,this.options.saveByValue?this.setSaveValue(this.input.value):this.setSaveValue(a),this.options.onSelect(this.input.value,a),this.hideResults()},a.prototype.selectSuggestedResult=function(a){return this.input.value=this.suggestionElm.dataset.result,this.options.saveByValue?this.setSaveValue(this.input.value):(this.options.selectedKey=c.where("value",this.input.value,this.options.data)[0].key,this.setSaveValue(this.options.selectedKey)),this.handleSearch(this.input.value),this.selectedResult=this.resultsElm.querySelector("a.index-0"),this.options.onSuggestionSelected(this.input.value,a)},a.prototype.handleActiveState=function(){return this.selectedResult=this.resultsElm.querySelector("a.index-"+this.selectedIndex),this.removeActiveState(),c.addClass("active",this.selectedResult),this.options.suggestResult?this.handleSuggestion(this.selectedResult.dataset.result):void 0},a.prototype.updateDomResults=function(a){var b;return"DOWN"===a&&(b=this.selectedIndex-(this.domCap-1)),"UP"===a&&(b=this.selectedIndex),this.manualScroll=!0,this.resultsWrapperElm.scrollTop=this.singleResultHeight*b},a.prototype.updateData=function(a){return this.options.data=a,this.handleSearch(this.input.value,!0)},a.prototype.setValue=function(a){return this.input.value=a,this.handleSearch(a)},a.prototype.render=function(a,b){return a.innerHTML=b},a.prototype.handleTemplate=function(){return this.containerClass="cm-container",this.inputWrapperClass="cm-input-wrap",this.resultsWrapperClass="cm-results-wrap",this.resultsClass="cm-results",this.noResultsClass="cm-without-results",this.highlightedMatchClass="cm-highlight",this.inputClass="cm-input",this.suggestionClass="cm-suggestion",this.tabindexSnippet=this.elm.dataset.tabindex?"tabindex="+this.elm.dataset.tabindex:"",this.template='<div class="'+this.inputWrapperClass+'">\n  <input type="text" class="'+this.inputClass+'" placeholder="'+this.options.placeholder+'" '+this.tabindexSnippet+'>\n  <input type="text" class="'+this.suggestionClass+'" disabled>\n</div>\n<div class="'+this.resultsWrapperClass+'">\n  <ul class="'+this.resultsClass+'"></ul>\n</div>',this.singleResultWrapper="<li></li>",this.singleResultContent='<a href="#" class="index-{{index}}" data-result="{{dataResult}}" data-index="{{dataIndex}}">\n  {{result}}\n</a>',this.noResultsContent='<li class="'+this.noResultsClass+'">\n  <i>'+this.options.noResultsText+' "{{searchValue}}"</i>\n  {{canAddNewRecordsSnippet}}\n</li>',this.canAddNewRecordsSnippet="<span>"+this.options.canAddNewRecordsText+"</span>",this.fetchingMoreResultsSnippet="<p>"+this.options.fetchingMoreResultsText+"</p>",this.render(this.elm,this.template),c.addClass(this.containerClass,this.elm),this.inputWrap=this.elm.querySelector("."+this.inputWrapperClass),this.input=this.elm.querySelector("."+this.inputWrapperClass+" input"),this.suggestionElm=this.elm.querySelector("."+this.suggestionClass),this.resultsWrapperElm=this.elm.querySelector("."+this.resultsWrapperClass),this.resultsElm=this.elm.querySelector("."+this.resultsClass)},a.prototype.insertSingleResultWrappers=function(){var a,b;for(a=0,b="";a<this.domResults.length;)b+=this.singleResultWrapper,a++;return this.render(this.resultsElm,b),this.addScrollSpace()},a.prototype.addScrollSpace=function(){var a,b;return this.singleResultHeight=this.resultsElm.querySelector("li").getBoundingClientRect().height,b=this.singleResultHeight*this.domResults.length,a=this.allResults.length*this.singleResultHeight-this.resultsWrapperElm.scrollTop,c.addHeight(b+"px",this.resultsWrapperElm),c.addHeight(a+"px",this.resultsElm)},a.prototype.handleResults=function(a){var b,c,d,e,f,g,h,i,j;for(f=this.domResults,c=d=0,e=f.length;e>d;c=++d)g=f[c],this.resultsAreObjects&&(g=g.value),b=this.input.value?this.highlightSearchTerm(g):g,i=this.singleResultContent.replace("{{index}}",a+c).replace("{{dataIndex}}",a+c).replace("{{result}}",b).replace("{{dataResult}}",g),h=this.resultsElm.querySelectorAll("li")[c],this.render(h,i);return j=this.resultsAreObjects?this.domResults[0].value:this.domResults[0],this.options.suggestResult&&this.resultsOpen?this.handleSuggestion(j):void 0},a.prototype.highlightSearchTerm=function(a){return c.highlightCharacterInString(this.input.value,a,this.highlightedMatchClass)},a.prototype.handleSuggestion=function(a){var b;return this.clearSuggestion(),this.input.value&&(b=0===a.toLowerCase().indexOf(this.input.value.toLowerCase()))?this.showSuggestion(a):void 0},a.prototype.showSuggestion=function(a){var b;return b=this.input.value+a.substring(this.input.value.length),this.suggestionElm.value=b,this.suggestionElm.dataset.result=a,this.options.onShowSuggestion(b)},a.prototype.clearSuggestion=function(){return this.suggestionElm.value="",this.suggestionElm.dataset.result="",this.options.onClearSuggestion()},a.prototype.handleScroll=function(a){return this.resultsElm.style.transform="translate(0px, "+a*this.singleResultHeight+"px)",this.resultsElm.style.webkitTransform="translate(0px, "+a*this.singleResultHeight+"px)"},a.prototype.handleFetchingResults=function(){return this.render(this.resultsElm,this.fetchingMoreResultsSnippet)},a.prototype.handleNoResults=function(a){var b,d;return b=this.options.canAddNewRecords?this.canAddNewRecordsSnippet:"",d=this.noResultsContent.replace("{{searchValue}}",a).replace("{{canAddNewRecordsSnippet}}",b),this.render(this.resultsElm,d),c.addHeight("auto",this.resultsWrapperElm),c.addHeight("auto",this.resultsElm)},a.prototype.showResults=function(){return this.resultsOpen=!0,c.addClass("results-showing",this.elm)},a.prototype.hideResults=function(){return this.resultsOpen=!1,this.options.suggestResult&&this.clearSuggestion(),c.removeClass("results-showing",this.elm)},a.prototype.removeActiveState=function(){var a;return a=this.resultsElm.querySelector("."+this.resultsClass+" a.active"),a?c.removeClass("active",a):void 0},a}(),window.CompleteMe=a,c={extend:function(){var a,b,c,d,e,g,h;for(g=arguments[0],e=2<=arguments.length?f.call(arguments,1):[],a=0,c=e.length;c>a;a++){d=e[a];for(b in d)h=d[b],g[b]=h}return g},where:function(a,b,c){var d;return d=[],c.filter(function(c){if("object"==typeof c){if(c[a]===b)return d.push(c)}else if(c===b)return d.push(c)}),d.length>0?d:void 0},addClass:function(a,b){return b.classList.add(a)},removeClass:function(a,b){return b.classList.remove(a)},addHeight:function(a,b){return b.style.height=a},findOccurrenceInArray:function(a,b){var c,d,e,f,g;for(f=[],a=a.toLowerCase(),c=d=0,e=b.length;e>d;c=++d)g=b[c],g.toLowerCase().indexOf(a)>-1&&f.push(g);return f},findOccurrenceInObject:function(a,b){var c,d,e,f,g;for(g=[],a=a.toLowerCase(),c=d=0,e=b.length;e>d;c=++d)f=b[c],f.value.toLowerCase().indexOf(a)>-1&&g.push(f);return g},highlightCharacterInString:function(a,b,c){var d;return d=new RegExp("("+a+")","gi"),b.replace(d,"<span class="+c+">$1</span>")},present:function(a){var b;return"string"==typeof a&&(b=a.length>0),"number"==typeof a&&(b=!0),b},throttle:function(a,b,c){var d,e,f,g,h,i;return e=void 0,d=void 0,h=void 0,i=null,g=0,c||(c={}),f=function(){g=c.leading===!1?0:Date.now(),i=null,h=a.apply(e,d),i||(e=d=null)},function(){var j,k;return j=Date.now(),g||c.leading!==!1||(g=j),k=b-(j-g),e=this,d=arguments,0>=k||k>b?(i&&(clearTimeout(i),i=null),g=j,h=a.apply(e,d),i||(e=d=null)):i||c.trailing===!1||(i=setTimeout(f,k)),h}},decode:function(a){var b,c;return b="(*_*)",a=a.join(b),c=document.createElement("textarea"),c.innerHTML=a,c.value.split(b)}},b={alphanumericKeys:{48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z"},upAndDownKeys:{38:"UP",40:"DOWN"},rightAndTabKeys:{39:"RIGHT",9:"TAB"},isAlphanumeric:function(a){return!!this.alphanumericKeys[a]},isUpOrDown:function(a){return!!this.upAndDownKeys[a]},isRightOrTab:function(a){return!!this.rightAndTabKeys[a]},isBackspace:function(a){return 8===a},isEnter:function(a){return 13===a},isSpace:function(a){return 32===a}}}).call(this);